<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bookmap-Style Heatmap Simulation</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin:0; background: linear-gradient(to right,#0f2027,#203a43,#2c5364); color:#fff; font-family:'Segoe UI',sans-serif; overflow:hidden;}
#chartContainer { width:90%; max-width:1200px; margin:50px auto; background: rgba(255,255,255,0.05); border-radius:15px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.3);}
canvas { width:100%; height:500px; }
</style>
</head>
<body>
<div id="chartContainer">
<canvas id="bookmapChart"></canvas>
</div>

<script>
// ====================== INITIAL SETUP ======================
const ctx = document.getElementById('bookmapChart').getContext('2d');

// Max visible candles
const MAX_POINTS = 100;

// Initialize data arrays
let prices = [];
let volumes = [];
let heatmap = [];
let labels = [];

// Generate initial data
let lastPrice = 100;
for(let i=0;i<MAX_POINTS;i++){
    let change = (Math.random()-0.5)*2;
    let price = lastPrice + change;
    let volume = Math.floor(Math.random()*100+20);
    let heat = Math.floor(Math.random()*100);
    prices.push(price);
    volumes.push(volume);
    heatmap.push(heat);
    labels.push(i);
    lastPrice = price;
}

// ====================== CHART ======================
const bookmapChart = new Chart(ctx,{
    type:'bar',
    data:{
        labels: labels,
        datasets:[
            {
                type:'line',
                label:'Price',
                data: prices,
                borderColor:'#00ffcc',
                borderWidth:2,
                fill:false,
                tension:0.3,
                yAxisID:'y1'
            },
            {
                type:'bar',
                label:'Liquidity Heatmap',
                data: volumes,
                backgroundColor: heatmap.map(v=>'rgba(255,0,255,'+v/100+')'),
                yAxisID:'y'
            }
        ]
    },
    options:{
        responsive:true,
        animation:false,
        interaction:{mode:'index', intersect:false},
        plugins:{legend:{display:true, labels:{color:'#fff'}}},
        scales:{
            y:{position:'left', title:{display:true,text:'Liquidity',color:'#fff'},ticks:{color:'#fff'}},
            y1:{position:'right', title:{display:true,text:'Price',color:'#fff'},ticks:{color:'#fff'}}
        },
        elements:{bar:{borderRadius:2}}
    }
});

// ====================== LIVE UPDATE ======================
function updateChart(){
    // Shift old data
    prices.shift();
    volumes.shift();
    heatmap.shift();
    labels.shift();

    // Generate new point
    let change = (Math.random()-0.5)*2;
    lastPrice += change;
    let newVolume = Math.floor(Math.random()*100+20);
    let newHeat = Math.floor(Math.random()*100);
    prices.push(parseFloat(lastPrice.toFixed(2)));
    volumes.push(newVolume);
    heatmap.push(newHeat);
    labels.push(labels[labels.length-1]+1);

    // Update colors dynamically
    bookmapChart.data.datasets[1].backgroundColor = heatmap.map(v=>'rgba(255,0,255,'+v/100+')');

    // Update chart
    bookmapChart.update();
}

// Update twice per second
setInterval(updateChart,500);
</script>
</body>
</html>
